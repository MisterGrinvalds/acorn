# Shell component configuration
# Note: This component generates as 'bootstrap.sh' to avoid conflict with the entrypoint 'shell.sh'
name: bootstrap
description: Core shell environment and XDG setup
version: 1.0.0

# Aliases (platform-specific)
aliases:
  # Navigation
  ..: "cd .."
  ...: "cd ../.."
  ....: "cd ../../.."
  .....: "cd ../../../.."
  "~": "cd ~"
  # Note: "-" alias causes "invalid option" error in bash - use "cd -" directly
  # Safety
  rm: "rm -i"
  cp: "cp -i"
  mv: "mv -i"
  mkdir: "mkdir -p"
  # Grep
  grep: "grep --color=auto"
  fgrep: "fgrep --color=auto"
  egrep: "egrep --color=auto"
  # Disk
  df: "df -h"
  du: "du -h"
  dud: "du -d 1 -h"
  duf: "du -sh *"
  # Process
  psg: "ps aux | grep -v grep | grep -i -e VSZ -e"
  top: "top -o cpu"
  # Date/Time
  now: "date +\"%Y-%m-%d %H:%M:%S\""
  nowdate: "date +\"%Y-%m-%d\""
  nowtime: "date +\"%H:%M:%S\""
  week: "date +%V"
  # Misc
  c: "clear"
  j: "jobs -l"
  path: "echo -e ${PATH//:/\\n}"
  reload: "source ~/.bashrc 2>/dev/null || source ~/.zshrc"

# Shell functions for bootstrap (must run before other components)
shell_functions:
  # Set platform-specific ls aliases
  __ls_aliases: |
    case "$CURRENT_PLATFORM" in
        darwin)
            alias ls='ls -G'
            alias ll='ls -lhG'
            alias la='ls -lahG'
            alias l='ls -CF'
            ;;
        linux)
            alias ls='ls --color=auto'
            alias ll='ls -lh --color=auto'
            alias la='ls -lah --color=auto'
            alias l='ls -CF --color=auto'
            ;;
    esac
    # Zsh-only: dash alias for cd - (bash can't alias -)
    [ -n "$ZSH_VERSION" ] && alias -- -='cd -'

  # Bootstrap initialization - sets up environment
  # MUST run first before any other component
  __shell_bootstrap: |
    # Homebrew PATH setup (macOS) - must be before shell detection
    if [ -x "/opt/homebrew/bin/brew" ]; then
        eval "$(/opt/homebrew/bin/brew shellenv)"
    elif [ -x "/usr/local/bin/brew" ]; then
        eval "$(/usr/local/bin/brew shellenv)"
    fi

    # Shell detection
    if [ -n "$ZSH_VERSION" ]; then
        export CURRENT_SHELL="zsh"
        export IS_LOGIN_SHELL="$([[ -o login ]] && echo true || echo false)"
    elif [ -n "$BASH_VERSION" ]; then
        export CURRENT_SHELL="bash"
        export IS_LOGIN_SHELL="$(shopt -q login_shell && echo true || echo false)"
    else
        export CURRENT_SHELL="sh"
        export IS_LOGIN_SHELL="false"
    fi

    # Platform detection
    case "$(uname -s)" in
        Darwin) export CURRENT_PLATFORM="darwin" ;;
        Linux) export CURRENT_PLATFORM="linux" ;;
        *) export CURRENT_PLATFORM="unknown" ;;
    esac

    # Interactive shell detection
    case "$-" in
        *i*) export IS_INTERACTIVE="true" ;;
        *) export IS_INTERACTIVE="false" ;;
    esac

    # Early exit for non-interactive shells (performance optimization)
    if [ "$IS_INTERACTIVE" = "false" ]; then
        return 0 2>/dev/null || exit 0
    fi

    # Dotfiles root (auto-detect or use default)
    if [ -z "$DOTFILES_ROOT" ]; then
        # Try to find acorn binary location and derive root
        if command -v acorn >/dev/null 2>&1; then
            _acorn_path="$(command -v acorn)"
            if [ -L "$_acorn_path" ]; then
                _acorn_path="$(readlink -f "$_acorn_path" 2>/dev/null || readlink "$_acorn_path")"
            fi
            # Assume acorn is in $DOTFILES_ROOT/bin or similar
            export DOTFILES_ROOT="${DOTFILES_ROOT:-$HOME/Repos/personal/tools}"
            unset _acorn_path
        else
            export DOTFILES_ROOT="${DOTFILES_ROOT:-$HOME/Repos/personal/tools}"
        fi
    fi

    # XDG Base Directory
    export XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
    export XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
    export XDG_CACHE_HOME="${XDG_CACHE_HOME:-$HOME/.cache}"
    export XDG_STATE_HOME="${XDG_STATE_HOME:-$HOME/.local/state}"

    # XDG Runtime Directory (platform-specific)
    if [ -z "$XDG_RUNTIME_DIR" ]; then
        case "$CURRENT_PLATFORM" in
            darwin)
                export XDG_RUNTIME_DIR="${TMPDIR:-/tmp}"
                ;;
            linux)
                if [ -d "/run/user/$(id -u)" ]; then
                    export XDG_RUNTIME_DIR="/run/user/$(id -u)"
                else
                    export XDG_RUNTIME_DIR="/tmp/runtime-$(id -u)"
                fi
                ;;
            *)
                export XDG_RUNTIME_DIR="/tmp"
                ;;
        esac
    fi

    # Acorn configuration directory
    export ACORN_CONFIG_DIR="${XDG_CONFIG_HOME}/acorn"

    # Component warning tracking
    export DOTFILES_WARNING_FILE="${XDG_STATE_HOME}/shell/component_warnings"
    mkdir -p "$(dirname "$DOTFILES_WARNING_FILE")" 2>/dev/null

    # Create essential directories
    mkdir -p "$ACORN_CONFIG_DIR" 2>/dev/null
    mkdir -p "$XDG_CONFIG_HOME" "$XDG_DATA_HOME" "$XDG_CACHE_HOME" "$XDG_STATE_HOME" 2>/dev/null

    # Mark components as loaded
    export DOTFILES_COMPONENTS_LOADED=1

  # XDG helper functions are provided by the xdg component
