# Git component configuration
name: git
description: Git version control configuration and aliases
version: 1.0.0

# Generated config file
# Creates a complete .gitconfig from declarative values
files:
  - target: "${HOME}/.gitconfig"
    format: gitconfig
    values:
      core:
        editor: nvim

      user:
        name: MisterGrinvalds
        email: "8541275+MisterGrinvalds@users.noreply.github.com"

      color:
        ui: auto

      # Git native aliases - faster than shell aliases
      alias:
        # Basic commands
        a: add
        A: "add -A"
        aa: "add --all"
        s: status
        c: commit
        cm: "commit -m"
        ca: "commit --amend"
        can: "commit --amend --no-edit"
        cA: "!git add -A && git commit"
        # Checkout/Branch
        co: checkout
        cob: "checkout -b"
        b: branch
        br: branch
        ba: "branch -a"
        bd: "branch -d"
        bD: "branch -D"
        # Diff
        d: diff
        dc: "diff --cached"
        ds: "diff --staged"
        # Fetch/Pull/Push
        f: fetch
        fa: "fetch --all"
        ff: "pull --ff"
        p: push
        pf: "push --force-with-lease"
        pu: "!git push -u origin $(git rev-parse --abbrev-ref HEAD)"
        pl: pull
        plr: "pull --rebase"
        # Merge/Rebase
        m: merge
        r: rebase
        ri: "rebase -i"
        rc: "rebase --continue"
        ra: "rebase --abort"
        # Stash
        st: stash
        stp: "stash pop"
        stl: "stash list"
        # Log
        l: log
        lo: "log --oneline -20"
        loa: "log --oneline --all --graph --decorate"
        lg: "log --graph --pretty=format:'%C(yellow)%h%Creset %C(red)%d%Creset %s %C(white)(%cr)%Creset %C(cyan)<%an>%Creset' --abbrev-commit"
        # Remote
        rv: "remote -v"
        ru: "remote update"
        # Reset
        rh: "reset HEAD"
        rhh: "reset HEAD --hard"
        rhs: "reset HEAD --soft"
        undo: "reset --soft HEAD~1"
        # Clean
        clean-fd: "clean -fd"
        pristine: "!git reset --hard && git clean -fdx"
        # Info
        w: whatchanged
        sh: "show --stat"
        bl: "blame -n"

      # Credential helpers
      credential:
        "https://github.com":
          helper:
            - ""
            - "!/opt/homebrew/bin/gh auth git-credential"
        "https://gist.github.com":
          helper:
            - ""
            - "!/opt/homebrew/bin/gh auth git-credential"

      # Conditional includes for work identity
      includeIf:
        "gitdir:~/Repos/work/":
          path: "~/.config/git/config.work"

# Sync work identity file (sensitive - not generated)
sync_files:
  - source: "config/git/config.work"
    target: "${HOME}/.config/git/config.work"
    mode: "symlink"

# Environment variables
env:
  DEFAULT_REPOS_DIR: "${DEFAULT_REPOS_DIR:-$HOME/Repos}"

# Shell aliases - shortcuts that invoke git
# These are faster to type than 'git <alias>'
aliases:
  g: "git"
  gs: "git status"
  gd: "git diff"
  gl: "git log --oneline -20"
  ga: "git add"
  gc: "git commit"
  gp: "git push"
  gpl: "git pull"
  gco: "git checkout"
  gb: "git branch"
  gst: "git stash"

# Wrapper functions that call acorn commands
wrappers:
  - name: ginfo
    command: "acorn git info"

  - name: gfind
    command: "acorn git find"

  - name: gcontrib
    command: "acorn git contributors"

  - name: gcleanb
    command: "acorn git clean-branches"

# Shell functions (only those that need cd or shell state)
shell_functions:
  # Clone and cd into repository
  gclone: |
    git clone "$1" && cd "$(basename "$1" .git)" || return
