# Session Summary: Config File Generation System Design

**Date:** 2026-01-06 18:54
**Branch:** feat/claude-tool-agents-commands
**Focus:** Component refactoring - Ghostty analysis and generic config file generation

## Accomplishments

### 1. Component Analysis System
- Ran `/component:component-analyze ghostty` command
- Analyzed Ghostty component structure
- Identified Ghostty config format: INI-like key=value (no sections)
- Documented config file location and structure

### 2. Codebase Exploration
- Explored component config system (`internal/componentconfig/`)
- Analyzed BaseConfig schema and loader patterns
- Reviewed shell generator and integration points
- Identified that no `tool_config` support exists yet

### 3. Generic Config File System Design
- Designed `files:` array for component config.yaml
- Supports multiple output formats: JSON, YAML, TOML, INI, Ghostty, keyvalue
- Schema-driven approach with type definitions
- Defined field types: string, int, bool, float, list, map

### 4. Created Claude Command
- **File:** `components/claude/config/commands/component/component-config-files-add.md`
- Full specification for adding config file support to components
- Includes schema reference, format table, field types
- Step-by-step instructions for implementation
- Example using Ghostty configuration

## Key Decisions

### 1. Comment Preservation
**Decision:** No comment preservation
**Rationale:** Values only, simpler implementation, comments lost on regeneration

### 2. Merge Strategy
**Decision:** config.yaml wins
**Rationale:** User's direct edits to target files are overwritten by config.yaml values

### 3. Implementation Scope
**Decision:** One format at a time, starting with Ghostty
**Rationale:** Build framework incrementally, add formats as needed per component

### 4. Workflow Approach
**Decision:** Create reusable Claude command for component refactoring
**Rationale:** Use `/component:config-files-add` during each component migration

## Technical Design

### Proposed Schema Structure

```yaml
files:
  - target: "${XDG_CONFIG_HOME}/ghostty/config"
    format: ghostty
    schema:
      theme: { type: string, default: "Catppuccin Mocha" }
      font-size: { type: int, default: 14 }
      keybind: { type: list, items: string }
    values:
      theme: "Catppuccin Mocha"
      font-size: 14
      keybind:
        - "super+d=new_split:right"
```

### Files to Create (Next Session)

**Schema Extension:**
- `internal/componentconfig/schema.go` - Add FileConfig and FieldSchema types

**Format Writers:**
- `internal/configfile/writer.go` - Writer interface and registry
- `internal/configfile/ghostty.go` - Ghostty format writer
- `internal/configfile/ghostty_reader.go` - Ghostty format reader
- `internal/configfile/manager.go` - File processing orchestration

**Integration:**
- `internal/componentconfig/loader.go` - Handle Files field in merge
- `internal/shell/shell.go` - Call file generation

**Component:**
- `components/ghostty/config.yaml` - Add files section with Ghostty config

## Research Findings

### Current Component System
- **BaseConfig:** No tool_config field (needs to be added)
- **Loading:** Two-stage merge (embedded â†’ user override)
- **Format Support:** YAML only (no INI/TOML/JSON parsers)
- **File Writing:** Standard os.WriteFile with DryRun support
- **User Overrides:** `~/.config/acorn/<component>.yaml`

### Ghostty Config Format
- Format: Key = value (INI-like, no sections)
- Location: `~/.config/ghostty/config`
- Special handling: Multi-value keys like `keybind` (appears multiple times)
- Documentation: https://ghostty.org/docs/config

### Supported Formats (Planned)

| Format | Output Style | Use Cases |
|--------|-------------|-----------|
| json | `{"key": "value"}` | VS Code, package.json |
| yaml | `key: value` | k8s, docker-compose |
| toml | `key = "value"` | Cargo.toml, pyproject.toml |
| ini | `[section]\nkey=value` | git config, editorconfig |
| ghostty | `key = value` (no sections) | Ghostty terminal |
| keyvalue | `key=value` | Simple configs |

## Incomplete Work

### Not Started
- Schema extension implementation
- Format writer implementation
- Ghostty config.yaml creation
- Testing and validation
- CLI commands for config management

### Pending User Input
None - all decisions made

## Files Modified

### Created
- `components/claude/config/commands/component/component-config-files-add.md`
  - New Claude command for adding config file support
  - 154 lines
  - Status: Ready to use

### To be Modified (Next Session)
- `internal/componentconfig/schema.go`
- `internal/componentconfig/loader.go`
- `internal/shell/shell.go`
- `components/ghostty/config.yaml`

## Next Session Plan

### Priority 1: Schema Extension
1. Add FileConfig and FieldSchema to schema.go
2. Add Files field to BaseConfig
3. Update loader MergeConfigs to handle Files

### Priority 2: Ghostty Format Writer
1. Create internal/configfile/ package
2. Implement Writer interface
3. Create GhosttyWriter
4. Handle multi-value keys (keybind)

### Priority 3: Integration
1. Update shell.sh to call file generation
2. Test with Ghostty component
3. Create ghostty config.yaml with files section

## Resources and Links

- Plan file: `.claude/plans/reactive-mixing-hare.md`
- Command location: `components/claude/config/commands/component/component-config-files-add.md`
- Ghostty docs: https://ghostty.org/docs/config
- Existing config: `components/ghostty/config/config`

## Notes

- Branch is clean except for the new command file
- User wants to restart session after stashing notes
- Ghostty will be the first component to use the new system
- Framework designed to be generic and reusable for all components
