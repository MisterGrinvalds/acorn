# Secrets component configuration
name: secrets
description: Secrets management and credential loading
version: 1.0.0

# Environment variables
env:
  SECRETS_DIR: "${SECRETS_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/secrets}"

# Shell aliases
aliases:
  secrets-load: "load_secrets"
  secrets-status: "acorn secrets status"
  secrets-validate: "acorn secrets validate"
  secrets-list: "acorn secrets list"
  check-aws: "acorn secrets check aws"
  check-azure: "acorn secrets check azure"
  check-github: "acorn secrets check github"
  check-do: "acorn secrets check digitalocean"

# Wrapper functions
wrappers:
  - name: secrets_status
    command: "acorn secrets status"

  - name: validate_secrets
    command: "acorn secrets validate"

  - name: list_secrets
    command: "acorn secrets list"

  - name: check_aws_key
    command: "acorn secrets check aws"

  - name: check_azure_key
    command: "acorn secrets check azure"

  - name: check_github_key
    command: "acorn secrets check github"

  - name: check_digitalocean_key
    command: "acorn secrets check digitalocean"

  - name: check_openai_key
    command: "acorn secrets check openai"

  - name: check_anthropic_key
    command: "acorn secrets check anthropic"

  - name: check_all_keys
    command: "acorn secrets check"

  - name: secrets_init
    command: "acorn secrets init"

  - name: secrets_path
    command: "acorn secrets path"

# Shell functions (source secrets into current shell)
shell_functions:
  # Auto-load secrets on shell init if enabled
  _secrets_init: |
    if [ "$AUTO_LOAD_SECRETS" = "true" ]; then
        if [ -f "$SECRETS_DIR/.env" ]; then
            set -a
            . "$SECRETS_DIR/.env"
            set +a
        fi
    fi

  # Load secrets into current shell environment
  load_secrets: |
    local secrets_file="${SECRETS_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/secrets}/.env"

    if [ -f "$secrets_file" ]; then
        if [ -r "$secrets_file" ]; then
            set -a
            . "$secrets_file"
            set +a
            echo "Secrets loaded into environment"
        else
            echo "Cannot read secrets file (check permissions)"
            return 1
        fi
    else
        echo "No secrets file found at: $secrets_file"
        echo "Run: acorn secrets init"
        return 1
    fi
