# XDG Base Directory component
# Provides additional XDG utilities and shell history management
name: xdg
description: XDG Base Directory utilities and shell history setup
version: 1.0.0

# Shell functions for XDG management
shell_functions:
  # Initialize XDG-compliant shell history
  _xdg_init: |
    # Shell history (XDG compliant location)
    _xdg_shell_dir="${XDG_STATE_HOME:-$HOME/.local/state}/shell"
    mkdir -p "$_xdg_shell_dir" 2>/dev/null
    export HISTFILE="$_xdg_shell_dir/${CURRENT_SHELL:-sh}_history"
    unset _xdg_shell_dir

    # Shell-specific history settings
    case "$CURRENT_SHELL" in
        bash)
            export HISTSIZE=10000
            export HISTFILESIZE=20000
            export HISTCONTROL="ignoreboth:erasedups"
            export HISTIGNORE="ls:cd:cd -:pwd:exit:date:* --help"
            shopt -s histappend 2>/dev/null
            ;;
        zsh)
            export HISTSIZE=10000
            export SAVEHIST=20000
            setopt HIST_IGNORE_DUPS 2>/dev/null
            setopt HIST_IGNORE_SPACE 2>/dev/null
            setopt SHARE_HISTORY 2>/dev/null
            setopt APPEND_HISTORY 2>/dev/null
            ;;
    esac

  # Get config directory for a component (with optional creation)
  xdg_config_dir: |
    local component="${1:?component name required}"
    local dir="${XDG_CONFIG_HOME:-$HOME/.config}/$component"
    [ -n "$2" ] && mkdir -p "$dir" 2>/dev/null
    echo "$dir"

  # Get data directory for a component
  xdg_data_dir: |
    local component="${1:?component name required}"
    local dir="${XDG_DATA_HOME:-$HOME/.local/share}/$component"
    [ -n "$2" ] && mkdir -p "$dir" 2>/dev/null
    echo "$dir"

  # Get cache directory for a component
  xdg_cache_dir: |
    local component="${1:?component name required}"
    local dir="${XDG_CACHE_HOME:-$HOME/.cache}/$component"
    [ -n "$2" ] && mkdir -p "$dir" 2>/dev/null
    echo "$dir"

  # Get state directory for a component
  xdg_state_dir: |
    local component="${1:?component name required}"
    local dir="${XDG_STATE_HOME:-$HOME/.local/state}/$component"
    [ -n "$2" ] && mkdir -p "$dir" 2>/dev/null
    echo "$dir"

  # Ensure all XDG directories exist for a component
  xdg_ensure_dirs: |
    local component="${1:-}"
    if [ -n "$component" ]; then
        mkdir -p "${XDG_CONFIG_HOME:-$HOME/.config}/$component" 2>/dev/null
        mkdir -p "${XDG_DATA_HOME:-$HOME/.local/share}/$component" 2>/dev/null
        mkdir -p "${XDG_CACHE_HOME:-$HOME/.cache}/$component" 2>/dev/null
        mkdir -p "${XDG_STATE_HOME:-$HOME/.local/state}/$component" 2>/dev/null
    else
        mkdir -p "${XDG_CONFIG_HOME:-$HOME/.config}" 2>/dev/null
        mkdir -p "${XDG_DATA_HOME:-$HOME/.local/share}" 2>/dev/null
        mkdir -p "${XDG_CACHE_HOME:-$HOME/.cache}" 2>/dev/null
        mkdir -p "${XDG_STATE_HOME:-$HOME/.local/state}" 2>/dev/null
    fi

  # Show XDG directory paths (useful for debugging)
  xdg_show: |
    echo "XDG_CONFIG_HOME: ${XDG_CONFIG_HOME:-$HOME/.config}"
    echo "XDG_DATA_HOME:   ${XDG_DATA_HOME:-$HOME/.local/share}"
    echo "XDG_CACHE_HOME:  ${XDG_CACHE_HOME:-$HOME/.cache}"
    echo "XDG_STATE_HOME:  ${XDG_STATE_HOME:-$HOME/.local/state}"
    echo "XDG_RUNTIME_DIR: ${XDG_RUNTIME_DIR:-not set}"
    echo "HISTFILE:        ${HISTFILE:-not set}"

  # Clean XDG cache for a component or all
  xdg_clean_cache: |
    local component="${1:-}"
    if [ -n "$component" ]; then
        local cache_dir="${XDG_CACHE_HOME:-$HOME/.cache}/$component"
        if [ -d "$cache_dir" ]; then
            rm -rf "$cache_dir"
            echo "Cleaned cache for $component"
        else
            echo "No cache directory for $component"
        fi
    else
        echo "Usage: xdg_clean_cache <component>"
        echo "Available caches:"
        ls -1 "${XDG_CACHE_HOME:-$HOME/.cache}/" 2>/dev/null | head -20
    fi
