# Neovim component configuration
name: neovim
description: Neovim editor configuration management
version: 1.0.0

# Shell aliases
aliases:
  v: "nvim"
  vi: "nvim"
  vim: "nvim"
  nv: "nvim"
  nvd: "nvim -d"

# Wrapper functions
wrappers:
  - name: nvim_health
    command: "acorn nvim health"

  - name: nvim_update
    command: "acorn nvim update"

  - name: nvim_plugin_info
    command: "acorn nvim plugin"

# Shell functions (interactive, uses read, cd)
shell_functions:
  # Variables used by functions
  _nvim_init: |
    NVIM_REPOS_DIR="${HOME}/Repos/personal"
    NVIM_DOTFILES_PLUGIN="${DOTFILES_ROOT}/config/neovim/plugin"

  # Clean cache/data with confirmation
  nvim_clean: |
    if [ "$1" = "-f" ] || [ "$1" = "--force" ]; then
        acorn nvim clean --force
    else
        echo "This will remove Neovim data, cache, and state directories."
        printf "Continue? [y/N] "
        read -r response
        if [ "$response" = "y" ] || [ "$response" = "Y" ]; then
            acorn nvim clean --force
        else
            echo "Cancelled."
        fi
    fi

  # Setup Neovim with external config repo
  nvim_setup: |
    local config_dir="${XDG_CONFIG_HOME:-$HOME/.config}/nvim"
    local repo_url=""
    local repo_name=""
    local repo_path=""
    local NVIM_REPOS_DIR="${HOME}/Repos/personal"

    echo "=== Neovim Configuration Setup ==="
    echo ""

    # Check if config already exists
    if [ -L "$config_dir" ]; then
        local current_target
        current_target=$(readlink "$config_dir")
        echo "Neovim config already linked to: $current_target"
        printf "Reconfigure? [y/N] "
        read -r response
        [ "$response" != "y" ] && [ "$response" != "Y" ] && return 0
        rm "$config_dir"
    elif [ -d "$config_dir" ]; then
        echo "Existing config directory found at $config_dir"
        printf "Backup and replace? [y/N] "
        read -r response
        if [ "$response" = "y" ] || [ "$response" = "Y" ]; then
            mv "$config_dir" "${config_dir}.backup.$(date +%Y%m%d%H%M%S)"
            echo "Backed up to ${config_dir}.backup.*"
        else
            return 0
        fi
    fi

    echo ""
    echo "Enter your Neovim config GitHub repo URL"
    echo "Examples:"
    echo "  https://github.com/username/nvim-config"
    echo "  git@github.com:username/kickstart.nvim.git"
    echo ""
    printf "Repo URL (or 'skip' to skip): "
    read -r repo_url

    if [ "$repo_url" = "skip" ] || [ -z "$repo_url" ]; then
        echo "Skipping Neovim config setup"
        return 0
    fi

    # Extract repo name from URL
    repo_name=$(basename "$repo_url" .git)
    repo_path="${NVIM_REPOS_DIR}/${repo_name}"

    # Ensure repos directory exists
    mkdir -p "$NVIM_REPOS_DIR"

    # Clone or update repo
    if [ -d "$repo_path" ]; then
        echo "Repo already exists at $repo_path"
        printf "Pull latest changes? [Y/n] "
        read -r response
        if [ "$response" != "n" ] && [ "$response" != "N" ]; then
            (cd "$repo_path" && git pull)
        fi
    else
        echo "Cloning $repo_url to $repo_path..."
        git clone "$repo_url" "$repo_path"
        if [ $? -ne 0 ]; then
            echo "Failed to clone repository"
            return 1
        fi
    fi

    # Create symlink
    ln -s "$repo_path" "$config_dir"
    echo ""
    echo "Neovim config linked: $config_dir -> $repo_path"
    echo ""
    echo "Run 'nvim' to start Neovim and install plugins"
